<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Campaign Details - Quantifyre Iris</title>

    <link rel="stylesheet" href="Css/client_style.css">
    <link rel="stylesheet" href="Css/client_sidebar.css">

    <link rel="stylesheet" href="Css/fontstyle.css">
    <link rel="stylesheet" href="Css/all.css">
    <link rel="stylesheet" href="Css/leaflet.css">
    <link rel="stylesheet" href="Css/leaflet.draw.css">
    <script src="Js/chart.js"></script>
</head>
<body>

    <div class="dashboard-container">
        <!-- <div class="sidebar-overlay"></div> -->

        <aside class="sidebar">
            <div class="sidebar-close-btn" id="sidebarClose">
                <i class="fa-solid fa-xmark"></i>
            </div>

            <div class="logo-section">
                <div class="logo-icon">
                    <img src="Images/quantifirelogo.png" alt="Logo">
                </div>
            </div>

            <div class="user-mini-profile">
                <div class="avatar-circle">
                    <img src="Images/ClientSlider.ico" alt="User">
                </div>
                <p>Client Name</p>
            </div>

            <nav>
                <ul>
                    <li><a href="ClientDashboard.html"><img src="Images/Dashboard30x30.ico"> Dashboard</a></li>
                    <li class="active"><a href="ClientCampaigns.html"><img src="Images/Campaign30x30.ico"> Campaigns</a></li>
                    <li><a href="ClientLeads.html"><img src="Images/Leads30x30.ico"> Leads</a></li>
                    <li><a href="Clientsetting.html"><img src="Images/Setting30x30.ico"> Settings</a></li>
                </ul>
            </nav>
        </aside>

        <main class="main-content">

            <header class="top-bar">
                <div class="menu-toggle" id="sidebarToggle">
                    <img src="Images/Slide.ico" alt="Toggle Menu">
                </div>

                <div class="search-bar">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    <input type="text" placeholder="Search campaigns, leads, locations...">
                </div>

                <div class="top-profile-actions">

                    <div class="notification-wrapper" onclick="toggleNavDropdown(event, 'notifDropdown')">
                        <div class="icon-btn notification" onclick="toggleNotification(event)">
                            <img src="Images/Notifications.ico" alt="Notifications">
                            <span class="notif-count">3</span>
                        </div>

                        <div class="notif-dropdown" id="notifDropdown">
                            <div class="notif-header">
                                <h4>Notifications</h4><span class="mark-read">Mark all read</span>
                            </div>
                            <ul class="notif-list">
                                <li class="notif-item unread">
                                    <div class="n-icon success"><i class="fa-solid fa-user-plus"></i></div>
                                    <div class="n-text">
                                        <p><strong>New Lead</strong></p><span>registered in Ahmadabad.</span>
                                    </div>
                                    <span class="n-time">2m</span>
                                </li>
                                <li class="notif-item unread">
                                    <div class="n-icon info"><i class="fa-solid fa-bullhorn"></i></div>
                                    <div class="n-text">
                                        <p><strong>Campaign</strong></p><span>"Summer Sale Started"</span>
                                    </div>
                                    <span class="n-time">1h</span>
                                </li>
                                <li class="notif-item">
                                    <div class="n-icon warning"><i class="fa-solid fa-file-invoice-dollar"></i></div>
                                    <div class="n-text">
                                        <p><strong>Payment</strong></p><span>received from Acme Corp.</span>
                                    </div>
                                    <span class="n-time">1d</span>
                                </li>
                            </ul>
                            <div class="notif-footer"><a href="#">View All Notifications</a></div>
                        </div>
                    </div>

                    <div class="profile-info" onclick="toggleNavDropdown(event, 'profileDropdown')">
                        <div class="avatar-small">
                            <img src="Images/ClientHeader.ico" alt="Profile">
                        </div>
                        <div class="text-info">
                            <h4>Adam Smith</h4>
                            <p>Client</p>
                        </div>
                        <i class="fa-solid fa-chevron-down" id="profileChevron"></i>
                    </div>

                    <div class="profile-dropdown" id="profileDropdown">
                        <div class="dropdown-header-info">
                            <p class="d-name">Adam Smith</p>
                            <span class="d-email">adam@quantifyre.com</span>
                        </div>
                        <ul class="dropdown-list">
                            <li><a href="profile.html"><i class="fa-regular fa-user"></i> My Profile</a></li>
                            <li><a href="Clientsetting.html"><i class="fa-solid fa-gear"></i> Settings</a></li>
                            <li><a href="#"><i class="fa-regular fa-circle-question"></i> Help Center</a></li>
                            <div class="dropdown-divider"></div>
                            <li><a href="javascript:void(0)" onclick="openLogoutModal()" ><i
                                class="fa-solid fa-arrow-right-from-bracket"></i> Logout</a></li>
                            </li>
                        </ul>
                    </div>
                </div>
            </header>

            <div class="page-header">
                <div class="title-text">
                    <div class="icon-square">
                        <img src="Images/Campaign50x50.ico">
                    </div>
                    <div>
                        <h1>Campaign Details</h1>
                        <p>Analytics & Performance Overview</p>
                    </div>
                </div>
                <div class="report-header-actions">
                    <a href="ClientCampaigns.html" class="btn-action"
                        style="background: #031414; text-decoration: none; display: inline-flex; align-items: center; gap: 5px; padding: 10px 15px; border-radius: 8px; color: #fff;">
                        <i class="fa-solid fa-arrow-left"></i> Back
                    </a>
                    <button class="btn-export"><i class="fa-solid fa-file-csv"></i>Export CSV</button>
                    <button class="btn-export"><i class="fa-solid fa-file-pdf"></i>Export PDF</button>
                </div>
            </div>

            <div class="campaign-banner">
                <div class="banner-info">
                    <h2>Summer Sale 2025</h2>
                    <div class="banner-meta">
                        <span>CMP-3303 • Mehsana, Surat</span>
                        <span class="status-indicator">
                            <span class="status-dot"></span> Active
                        </span>
                    </div>
                </div>
                <div class="banner-date">
                    <span>Duration</span>
                    <h3>01 Nov - 30 Nov 2025</h3>
                </div>
            </div>

            <div class="middle-section">

                <div class="map-card">
                    <h3>Geofence Map </h3>

                    <div class="map-toolbar-inner">
                        <div class="custom-dropdown" id="shapeDropdown">
                            <div class="dropdown-trigger" onclick="toggleDropdown(event)">
                                <span id="selectedToolText"><i class="far fa-circle"></i> Circle</span>
                                <i class="fas fa-chevron-down" style="font-size: 0.7rem;"></i>
                            </div>
                            <ul class="dropdown-menu">
                                <li class="dropdown-item" onclick="selectTool('circle', 'Circle')"><i
                                        class="far fa-circle"></i> Circle</li>
                                <li class="dropdown-item" onclick="selectTool('rectangle', 'Rectangle')"><i
                                        class="far fa-square"></i> Rectangle</li>
                                <li class="dropdown-item" onclick="selectTool('polygon', 'Polygon')"><i
                                        class="fas fa-draw-polygon"></i> Polygon</li>
                            </ul>
                        </div>
                        <input type="text" id="customSearchInput" class="map-input" placeholder="City..."
                            onkeypress="handleEnter(event)">
                        <button class="btn-icon btn-search" id="searchBtn" onclick="performDirectSearch()"><i
                                class="fas fa-search"></i></button>
                        <input type="number" id="radiusInput" class="map-input" placeholder="Rad(m)"
                            onkeypress="handleEnter(event)">
                        <button class="btn-icon btn-check" onclick="applyFilter()"><i class="fas fa-check"></i></button>
                        <button class="btn-icon btn-clear" onclick="clearMap()"><i
                                class="fas fa-trash-alt"></i></button>
                    </div>

                    <div id="geofenceMap" class="dark-theme-map"></div>
                </div>

                <div class="kpi-grid-2x2">
                    <div class="stat-card">
                        <p>Conversion Rate</p>
                        <h2>23.5%</h2>
                    </div>
                    <div class="stat-card">
                        <p>Total Leads</p>
                        <h2>350</h2>
                    </div>
                    <div class="stat-card">
                        <p>Budget Spent</p>
                        <h2>₹ 40,000</h2>
                    </div>
                    <div class="stat-card">
                        <p>Active Ads</p>
                        <h2>10</h2>
                    </div>
                </div>

            </div>

            <div class="chart-container" style="height: 400px;">
                <div class="chart-header" style="margin-left:20px;margin-top: 15px;">Leads & Performance</div>
                <div class="chart-wrapper">
                    <canvas id="detailsChart"></canvas>
                </div>
            </div>

        </main>
    </div>

    <!-- Logut Model Logic -->
    <div class="modal-overlay" id="logoutModal">
        <div class="modal-content">
            <div class="modal-icon-box2">
                <i class="fa-solid fa-arrow-right-from-bracket"></i>
            </div>
            <h2>Ready to Leave?</h2>
            <p>Are you sure you want to logout? You will need to login again to access your dashboard.</p>
            <div class="modal-actions">
                <button class="btn-modal btn-modal-cancel" onclick="closeLogoutModal()">Cancel</button>
                <button class="btn-modal btn-modal-delete" onclick="confirmLogout()">Logout</button>
            </div>
        </div>
    </div>

    <script src="Js/jquery-3.7.1.min.js"></script>
    <script src="Js/leaflet.js"></script>
    <script src="Js/leaflet.draw.js"></script>
    <script src="Js/allclient.js"></script>

    <script>
        // ================= MAP LOGIC =================
        var map = L.map('geofenceMap', { zoomControl: false }).setView([20.5937, 78.9629], 5);
        L.control.zoom({ position: 'bottomright' }).addTo(map);

        L.tileLayer('https://{s}.tile.openstreetmap.org/{z}/{x}/{y}.png', { maxZoom: 19 }).addTo(map);
        var drawnItems = new L.FeatureGroup().addTo(map);
        var currentDrawer = null;
        var selectedShape = 'circle';
        var lastSearchLocation = null;

        function toggleDropdown(e) {
            e.stopPropagation();
            document.getElementById('shapeDropdown').classList.toggle('active');
        }
        document.addEventListener('click', e => {
            if (!e.target.closest('.custom-dropdown')) document.getElementById('shapeDropdown').classList.remove('active');
        });

        function selectTool(type, name) {
            selectedShape = type;
            let icon = type === 'polygon' ? 'fa-draw-polygon' : (type === 'circle' ? 'fa-circle' : 'fa-square');
            let prefix = type === 'polygon' ? 'fas' : 'far';
            document.getElementById('selectedToolText').innerHTML = `<i class="${prefix} ${icon}"></i> ${name}`;
            document.getElementById('shapeDropdown').classList.remove('active');
            if (document.getElementById('radiusInput').value && type !== 'polygon' && lastSearchLocation) applyFilter();
        }

        async function performDirectSearch() {
            var query = document.getElementById('customSearchInput').value;
            if (!query) { alert("Enter location!"); return; }
            try {
                const response = await fetch(`https://nominatim.openstreetmap.org/search?format=json&q=${encodeURIComponent(query)}`);
                const data = await response.json();
                if (data && data.length > 0) {
                    const place = data[0];
                    const lat = parseFloat(place.lat);
                    const lon = parseFloat(place.lon);
                    lastSearchLocation = L.latLng(lat, lon);
                    map.setView([lat, lon], 13);
                    drawnItems.clearLayers();
                    L.marker([lat, lon]).addTo(drawnItems).bindPopup(`<b>${place.display_name.split(',')[0]}</b>`).openPopup();
                    if (document.getElementById('radiusInput').value) applyFilter();
                } else { alert("Location not found."); }
            } catch (e) { alert("Search failed."); }
        }

        function applyFilter() {
            var radius = parseFloat(document.getElementById('radiusInput').value);
            var center = lastSearchLocation || map.getCenter();
            drawnItems.clearLayers();
            if (lastSearchLocation) L.marker(lastSearchLocation).addTo(drawnItems);
            if (selectedShape === 'polygon') {
                if (currentDrawer) currentDrawer.disable();
                currentDrawer = new L.Draw.Polygon(map, { shapeOptions: { color: '#00d4ff', fillOpacity: 0.2 } });
                currentDrawer.enable();
            } else {
                if (!radius || radius <= 0) { alert("Enter Radius (meters)"); return; }
                if (selectedShape === 'circle') {
                    var circle = L.circle(center, { color: '#ff6b6b', fillColor: '#ff6b6b', fillOpacity: 0.2, radius: radius }).addTo(drawnItems);
                    map.fitBounds(circle.getBounds());
                } else if (selectedShape === 'rectangle') {
                    var earthRadius = 6378137;
                    var latRadius = (radius / earthRadius) * (180 / Math.PI);
                    var lngRadius = latRadius / Math.cos(center.lat * Math.PI / 180);
                    var bounds = [[center.lat - latRadius, center.lng - lngRadius], [center.lat + latRadius, center.lng + lngRadius]];
                    var rect = L.rectangle(bounds, { color: '#00ffaa', fillOpacity: 0.2 }).addTo(drawnItems);
                    map.fitBounds(rect.getBounds());
                }
            }
        }

        function clearMap() {
            drawnItems.clearLayers();
            if (currentDrawer) currentDrawer.disable();
            document.getElementById('radiusInput').value = '';
            document.getElementById('customSearchInput').value = '';
            lastSearchLocation = null;
            map.setView([20.5937, 78.9629], 5);
        }

        function handleEnter(e) {
            if (e.key === 'Enter') {
                if (e.target.id === 'customSearchInput') performDirectSearch();
                if (e.target.id === 'radiusInput') applyFilter();
            }
        }

        map.on(L.Draw.Event.CREATED, function (e) {
            drawnItems.addLayer(e.layer);
        });

        // ================= CHART CONFIGURATION =================
        const ctx = document.getElementById('detailsChart').getContext('2d');
        let gradientGreen = ctx.createLinearGradient(0, 0, 0, 400);
        gradientGreen.addColorStop(0, 'rgba(0, 255, 170, 0.4)');
        gradientGreen.addColorStop(1, 'rgba(0, 255, 170, 0)');

        let gradientBlue = ctx.createLinearGradient(0, 0, 0, 400);
        gradientBlue.addColorStop(0, 'rgba(0, 212, 255, 0.4)');
        gradientBlue.addColorStop(1, 'rgba(0, 212, 255, 0)');

        new Chart(ctx, {
            type: 'line',
            data: {
                labels: ['01 Nov', '05 Nov', '08 Nov', '12 Nov', '15 Nov', '18 Nov', '20 Nov'],
                datasets: [
                    {
                        label: 'Total Leads',
                        data: [20, 45, 48, 55, 75, 90, 110],
                        borderColor: '#00d4ff', backgroundColor: gradientBlue,
                        borderWidth: 2, tension: 0.4, fill: true,
                        pointBackgroundColor: '#05080a', pointBorderColor: '#00d4ff', pointRadius: 4
                    },
                    {
                        label: 'Conversion Rate (%)',
                        data: [20, 35, 60, 80, 88, 95, 105],
                        borderColor: '#00ffaa', backgroundColor: gradientGreen,
                        borderWidth: 2, tension: 0.4, fill: true,
                        pointBackgroundColor: '#05080a', pointBorderColor: '#00ffaa', pointRadius: 4
                    }
                ]
            },
            options: {
                responsive: true, maintainAspectRatio: false,
                plugins: { legend: { position: 'top', labels: { color: '#a0a0a0', usePointStyle: true, boxWidth: 8 } } },
                scales: {
                    x: { grid: { color: 'rgba(255, 255, 255, 0.05)' }, ticks: { color: '#8b9c9c' } },
                    y: { grid: { color: 'rgba(255, 255, 255, 0.05)' }, ticks: { color: '#8b9c9c' }, beginAtZero: true }
                }
            }
        });

    </script>

</body>

</html>